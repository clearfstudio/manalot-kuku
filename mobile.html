<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>ä¹ä¹ãƒã‚¹ã‚¿ãƒ¼</title>
    <style>

body, html {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100vh;
  display: flex;
  justify-content: center; /* æ¨ªä¸­å¤® */
  align-items: center;     /* ç¸¦ä¸­å¤® */
  background-color: #f0f8ff; /* èƒŒæ™¯è‰²ãªã©ã¯ãŠå¥½ã¿ã§ */
  font-family: "Helvetica", "Arial", "æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“", "Yu Gothic", "Meiryo", sans-serif;
}

      h2 {
        font-size: 20px;
        font-weight: bold;
        color: #fff9c4;
        margin: 0;
        line-height: 1.6;
      }

      select {
        touch-action: manipulation;
        -webkit-user-select: none;
        user-select: none;
        text-align: center;
        text-align-last: center; /* for option text alignment */
      }

.game-wrapper {
  width: 100%;
  height: 85vh; /* ç”»é¢ã®é«˜ã•ã„ã£ã±ã„ */
  margin: 0;
  border: 5px solid #66ccff;
  border-radius: 15px; /* ã‚¹ãƒãƒ›ã§ã¯è§’ã‚’ãªãã™ã¨è‡ªç„¶ */
  background-color: #ffffff;
  box-shadow: none; /* ã‚¹ãƒãƒ›ã§ã¯å½±ã‚‚çœç•¥ã—ã¦ã‚‚OK */
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  text-align: center;
}

      .header {
        background-color: #66ccff;
        padding: 5px;
        font-size: 18px;
        font-weight: bold;
        color:  white;
        border-bottom: 3px solid #66ccff;
      }

      .main {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-grow: 1;
        padding: 10px;
        overflow: hidden;
        position: relative;
      }

      .footer {
        background-color: #e6f7ff;
        padding: 5px;
        border-top: 3px solid #66ccff;
      }

      .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .footer-left,
      .footer-right {
        display: flex;
      }

      button {
        font-size: 20px;
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        background-color: #4a90e2;
        color: white;
        cursor: pointer;
        touch-action: manipulation;
        -webkit-user-select: none;
        user-select: none;
      }

      button:hover {
        background-color: #3a7ac9;
      }

      .user-select {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }

      .user-select label {
        font-size: 20px;
        font-weight: bold;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        text-align-last: center;
      }

.user-select select {
  font-size: 18px;
  padding: 8px 12px;
  border: 2px solid #66ccff;
  border-radius: 12px;
  background-color: #ffffff;
  color: #333;
  width: 150px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

.user-select select:focus {
  outline: none;
  border-color: #3399cc;
  box-shadow: 0 0 4px #66ccff;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4); /* åŠé€æ˜ã®èƒŒæ™¯ */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background-color: #fff;
  padding: 30px 20px;
  border-radius: 15px;
  width: 300px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.modal-content p {
  font-size: 18px;
  margin-bottom: 20px;
  color: #333;
}

.modal-content button {
  font-size: 16px;
  padding: 8px 16px;
  background-color: #4a90e2;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

.modal-content button:hover {
  background-color: #3399cc;
}

.password-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 500px;
  margin: 0 auto;
}

.pw-title {
  font-size: 18px;
  font-weight: bold;
  margin: 5px;
}

.pw-display {
  display: flex;
  letter-spacing: 8px;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: 32px;
  font-weight: bold;
  padding: 10px 10px;
  padding-left: 20px;
  border: 3px solid #4a90e2;
  border-radius: 12px;
  background-color: #f5f5f5;
  width: 150px;
  height: 40px;
  margin-top: 5px;
  margin-bottom: 10px;
  margin-right: 9px;
}

.pw-keypad {
  display: grid;
  grid-template-columns: repeat(3, 60px);
  gap: 8px;
  justify-content: center;
  margin: 5px auto;
}

.pw-btn {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: none;
  background-color: #4a90e2;
  color: white;
  font-size: 25px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}


.pw-btn:hover {
  background-color: #3a7ac9;
}

.action-btn {
  font-size: 15px;
  padding: 8px 8px;
  margin: 0 10px;
  border: none;
  border-radius: 10px;
  background-color: #4a90e2;
  color: white;
  cursor: pointer;
}

.action-btn:hover {
  background-color: #3a7ac9;
}

.action-btn2 {
  font-size: 18px;
  padding: 10px 10px;
  margin: 0 10px;
  border: none;
  border-radius: 10px;
  background-color: #f6a828;
  color: white;
  cursor: pointer;
}

.action-btn2:hover {
  background-color: #e59400;
}

.stage-btn {
  font-size: 14px;
  padding: 3px 5px;
  width: 100px;
  margin: 0px;
  border: none;
  border-radius: 8px;
  background-color: #66ccff;
  color: white;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.stage-btn:hover {
  background-color: #3399cc;
}

.stage-btn2 {
  font-size: 14px;
  padding: 3px 5px;
  width: 280px;
  height: 60px;
  margin: 0px;
  border: none;
  border-radius: 5px;
  background-color: #66ccff;
  color: white;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.stage-btn2:hover {
  background-color: #3399cc;
}

.stage-label-btn {
  font-size: 23px;
  font-weight: bold;
  color: black;
  padding: 6px 9px;
  width: 250px;
  text-align: center;
  border: 2px solid #66ccff;
  border-radius: 12px;
  background: white;
  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}
.stage-label-btn:hover {
  background-color: #e0f7ff;
}

.stage-label-btn.completed {
  background-color: #e0ffe0;
  border-color: #66cc66;
}
.stage-label-btn.completed:hover {
  background-color: #ccffcc;
}

.mode-select-group {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
}

.mode-select-btn {
  width: 190px;
  height: 110px;
  font-size: 25px;
  font-weight: bold;
  color: black;
  padding: 8px;
  border: 5px solid #66ccff;
  border-radius: 12px;
  background: white;
  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
}

.mode-select-btn:hover {
  background-color: #e0f7ff;
}

.mode-select-btn.completed {
  background-color: #e0ffe0;
  border-color: #66cc66;
}

.mode-select-btn.completed:hover {
  background-color: #ccffcc;
}

.key-btn {
  font-size: 36px;
  font-weight: bold;
  width: 72px;
  height:72px;
  padding: 7px;
  border-radius: 10px;
  background-color: #4a90e2;
  color: white;
  border: none;
  cursor: pointer;
}
.key-btn:hover {
  background-color: #3a7ac9;
}

#timerArea {
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;         /* â† ã“ã‚ŒãŒé‡è¦ */
  bottom: 20px;                  /* ä¸Šã‹ã‚‰20px */
  left: 20px;                /* å³ã‹ã‚‰20pxï¼ˆã¾ãŸã¯ left: 20px ã«ã™ã‚Œã°å·¦ä¸Šï¼‰ */
}

#backModalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.4);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

#backModalBox {
  background-color: #fff;
  padding: 20px 30px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
}

#backModalBox button {
  font-size: 16px;
  padding: 8px 16px;
  margin: 0 8px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

/* ã€Œã¯ã„ã€ãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ */
#backOkButton {
  background-color: #ffa726;
  color: white;
}

#backOkButton:hover {
  background-color: #fb8c00;
}

/* ã€Œã„ã„ãˆã€ãƒœã‚¿ãƒ³ï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰ */
#backCancelButton {
  background-color: #e0e0e0;
  color: #333;
}

#backCancelButton:hover {
  background-color: #bdbdbd;
}

.ok-key {
  background-color: #f57c00;
}

.del-key {
  background-color: #f48f8f;
}

.ok-key:hover {
  background-color: #ef6c00;
}

.del-key:hover {
  background-color: #e57373;
}

@keyframes explode {
  to {
    transform: translate(var(--x), var(--y)) rotate(720deg);
  }
}

.confetti {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  opacity: 1;
  z-index: 9999;
}

.empty-key {
  pointer-events: none;        /* æŠ¼ã›ãªã„ã‚ˆã†ã«ã™ã‚‹ */
  background: transparent;     /* èƒŒæ™¯ã‚’æ¶ˆã™ */
  border: none;                /* æ ã‚‚æ¶ˆã™ */
  min-width: 10px;             /* å¿…è¦ãªã‚‰æœ€å°ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
  height: 1px;                 /* é«˜ã•ã‚’ã»ã¼ã‚¼ãƒ­ã«ã™ã‚‹ã“ã¨ã§è¦‹ãŸç›®ã‚¹ãƒªãƒ ã« */
  padding: 0;
}


.empty-key:hover,
.empty-key:active,
.empty-key:focus {
  background-color: transparent;
  box-shadow: none;
  outline: none;
}

    </style>
  </head>
  <body>
  <div class="game-wrapper">
    <div class="header" id="headerArea"></div>
    <div class="main" id="mainArea"></div>
    <div class="footer" id="footerArea"></div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
<div id="modalOverlay" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <p id="modalMessage">ã‚¨ãƒ©ãƒ¼</p>
    <button id="modalOkButton" onclick="closeModal()">OK</button>
  </div>
</div>

<div id="backModalOverlay" style="display: none;">
  <div id="backModalBox">
    <p id="backModalMessage">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚‚ã©ã‚Šã¾ã™ã‹ï¼Ÿ</p>
    <div style="margin-top: 10px;">
      <button id="backOkButton">ã¯ã„</button>
      <button id="backCancelButton">ã„ã„ãˆ</button>
    </div>
  </div>
</div>

    <script>
      //ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
      let currentUser = null;
      let enteredPassword = "";
      let key = null;
      let clearnumber = 3; //ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ã¨ãªã‚‹å›æ•°ã€€å¤‰æ›´å¯
      let allclearnumber = 5; //ã™ã¹ã¦ã®ã ã‚“ã«ã¡ã‚‡ã†ã›ã‚“ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ã¨ãªã‚‹å›æ•°ã€€å¤‰æ›´å¯
      let cleartime = 5; //ã‚¯ãƒªã‚¢åŸºæº–ã¨ãªã‚‹ï¼‘å•ã®ç§’æ•°ã€€å¤‰æ›´å¯
      let cleartimesec = cleartime * 1000; //ã‚¯ãƒªã‚¢åŸºæº–ã¨ãªã‚‹ï¼‘å•ã®ç§’æ•°ã‚’ãƒŸãƒªã«å¤‰æ›
      let clearobject = null;
      let currentStageNumber = null;
      let currentStageMode = null;
      let questionSet = []; // å•é¡Œã‚»ãƒƒãƒˆ
      let currentQuestionIndex = 0;
      let userAnswer = "";
      let startTime = 0;
      let correctArray = [];
      let timeArray = [];
      let timerAnimationId = null;
      let timeokcount = 0;
      let answerokcount = 0;
      let allQuestions = []; // ã™ã¹ã¦ã®ã ã‚“ç”¨ã®å•é¡Œã‚»ãƒƒãƒˆ
      let isReturningToMenu = false; // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚‚ã©ã‚‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
      let isInputLocked = false; // å›ç­”è¡¨ç¤ºä¸­ã®å…¥åŠ›ãƒ­ãƒƒã‚¯ãƒ•ãƒ©ã‚°

      let smileimage = 'facesmile.png'
      let nomalimage = 'facenomal.png'
      let questionimage = 'facequestion.png'
      let sadimage = 'facesad.png'
      let nomalimage2 = 'facenomal2.png'

// å•é¡Œã®èª­ã¿ï¼ˆã€Œã«ã«ã‚“ãŒã€ãªã©ï¼‰
const questionReadings = {
  1: ["ã„ã‚“ã„ã¡ãŒ", "ã„ã‚“ã«ãŒ", "ã„ã‚“ã•ã‚“ãŒ", "ã„ã‚“ã—ãŒ", "ã„ã‚“ã”ãŒ", "ã„ã‚“ã‚ããŒ", "ã„ã‚“ã—ã¡ãŒ", "ã„ã‚“ã¯ã¡ãŒ", "ã„ã‚“ããŒ"],
  2: ["ã«ã„ã¡ãŒ", "ã«ã«ã‚“ãŒ", "ã«ã•ã‚“ãŒ", "ã«ã—ãŒ", "ã«ã”", "ã«ã‚ã", "ã«ã—ã¡", "ã«ã¯ã¡", "ã«ã"],
  3: ["ã•ã‚“ã„ã¡ãŒ", "ã•ã‚“ã«ãŒ", "ã•ã–ã‚“ãŒ", "ã•ã‚“ã—", "ã•ã‚“ã”", "ã•ã¶ã‚ã", "ã•ã‚“ã—ã¡", "ã•ã‚“ã±", "ã•ã‚“ã"],
  4: ["ã—ã„ã¡ãŒ", "ã—ã«ãŒ", "ã—ã•ã‚“", "ã—ã—", "ã—ã”", "ã—ã‚ã", "ã—ã—ã¡", "ã—ã¯", "ã—ã"],
  5: ["ã”ã„ã¡ãŒ", "ã”ã«", "ã”ã•ã‚“", "ã”ã—", "ã”ã”", "ã”ã‚ã", "ã”ã—ã¡", "ã”ã¯", "ã”ã£ã"],
  6: ["ã‚ãã„ã¡ãŒ", "ã‚ãã«", "ã‚ãã•ã‚“", "ã‚ãã—", "ã‚ãã”", "ã‚ãã‚ã", "ã‚ãã—ã¡", "ã‚ãã¯", "ã‚ã£ã"],
  7: ["ã—ã¡ã„ã¡ãŒ", "ã—ã¡ã«", "ã—ã¡ã•ã‚“", "ã—ã¡ã—", "ã—ã¡ã”", "ã—ã¡ã‚ã", "ã—ã¡ã—ã¡", "ã—ã¡ã¯", "ã—ã¡ã"],
  8: ["ã¯ã¡ã„ã¡ãŒ", "ã¯ã¡ã«", "ã¯ã¡ã•ã‚“", "ã¯ã¡ã—", "ã¯ã¡ã”", "ã¯ã¡ã‚ã", "ã¯ã¡ã—ã¡", "ã¯ã£ã±", "ã¯ã£ã"],
  9: ["ãã„ã¡ãŒ", "ãã«", "ãã•ã‚“", "ãã—", "ãã”", "ãã‚ã", "ãã—ã¡", "ãã¯", "ãã"]
};

// ç­”ãˆã®èª­ã¿ï¼ˆã€Œã«ã€ã€Œã—ã€ãªã©ï¼‰
const answerReadings = {
  1: ["ã„ã¡", "ã«", "ã•ã‚“", "ã—", "ã”", "ã‚ã", "ã—ã¡", "ã¯ã¡", "ã"],
  2: ["ã«", "ã—", "ã‚ã", "ã¯ã¡", "ã˜ã‚…ã†", "ã˜ã‚…ã†ã«", "ã˜ã‚…ã†ã—", "ã˜ã‚…ã†ã‚ã", "ã˜ã‚…ã†ã¯ã¡"],
  3: ["ã•ã‚“", "ã‚ã", "ã", "ã˜ã‚…ã†ã«", "ã˜ã‚…ã†ã”", "ã˜ã‚…ã†ã¯ã¡", "ã«ã˜ã‚…ã†ã„ã¡", "ã«ã˜ã‚…ã†ã—", "ã«ã˜ã‚…ã†ã—ã¡"],
  4: ["ã—", "ã¯ã¡", "ã˜ã‚…ã†ã«", "ã˜ã‚…ã†ã‚ã", "ã«ã˜ã‚…ã†", "ã«ã˜ã‚…ã†ã—", "ã«ã˜ã‚…ã†ã¯ã¡", "ã•ã‚“ã˜ã‚…ã†ã«", "ã•ã‚“ã˜ã‚…ã†ã‚ã"],
  5: ["ã”", "ã˜ã‚…ã†", "ã˜ã‚…ã†ã”", "ã«ã˜ã‚…ã†", "ã«ã˜ã‚…ã†ã”", "ã•ã‚“ã˜ã‚…ã†", "ã•ã‚“ã˜ã‚…ã†ã”", "ã—ã˜ã‚…ã†", "ã—ã˜ã‚…ã†ã”"],
  6: ["ã‚ã", "ã˜ã‚…ã†ã«", "ã˜ã‚…ã†ã¯ã¡", "ã«ã˜ã‚…ã†ã—", "ã•ã‚“ã˜ã‚…ã†", "ã•ã‚“ã˜ã‚…ã†ã‚ã", "ã—ã˜ã‚…ã†ã«", "ã—ã˜ã‚…ã†ã¯ã¡", "ã”ã˜ã‚…ã†ã—"],
  7: ["ã—ã¡", "ã˜ã‚…ã†ã—", "ã«ã˜ã‚…ã†ã„ã¡", "ã«ã˜ã‚…ã†ã¯ã¡", "ã•ã‚“ã˜ã‚…ã†ã”", "ã—ã˜ã‚…ã†ã«", "ã—ã˜ã‚…ã†ã", "ã”ã˜ã‚…ã†ã‚ã", "ã‚ãã˜ã‚…ã†ã•ã‚“"],
  8: ["ã¯ã¡", "ã˜ã‚…ã†ã‚ã", "ã«ã˜ã‚…ã†ã—", "ã•ã‚“ã˜ã‚…ã†ã«", "ã—ã˜ã‚…ã†", "ã—ã˜ã‚…ã†ã¯ã¡", "ã”ã˜ã‚…ã†ã‚ã", "ã‚ãã˜ã‚…ã†ã—", "ã—ã¡ã˜ã‚…ã†ã«"],
  9: ["ã", "ã˜ã‚…ã†ã¯ã¡", "ã«ã˜ã‚…ã†ã—ã¡", "ã•ã‚“ã˜ã‚…ã†ã‚ã", "ã—ã˜ã‚…ã†ã”", "ã”ã˜ã‚…ã†ã—", "ã‚ãã˜ã‚…ã†ã•ã‚“", "ã—ã¡ã˜ã‚…ã†ã«", "ã¯ã¡ã˜ã‚…ã†ã„ã¡"]
};

function showInitialScreen() {
  currentStageNumber = null;
  currentStageMode = null;
  questionSet = []; // å•é¡Œã‚»ãƒƒãƒˆ
  currentQuestionIndex = 0;
  userAnswer = "";
  startTime = 0;
  correctArray = [];
  timeArray = [];
  timeokcount = 0;
  answerokcount = 0;
  isReturningToMenu = false;
  // ãƒ˜ãƒƒãƒ€ãƒ¼
  document.getElementById("headerArea").innerHTML = `
  <h2>ã‚ã–ã›ä¹ä¹ãƒã‚¹ã‚¿ãƒ¼ï¼</h2>
  `;

  // ãƒ¡ã‚¤ãƒ³
  let col1 = "<div style='display: flex; flex-direction: column; gap: 10px;'>"; // 1ã€œ5ã®æ®µ
  let col2 = "<div style='display: flex; flex-direction: column; gap: 10px;'>"; // 6ã€œ9ã®æ®µï¼‹ã™ã¹ã¦

  for (let i = 1; i <= 9; i++) {
    const buttonHtml = `
      <button class="stage-label-btn" onclick="selectStageMode(${i})">
        <span>${i}ã®ã ã‚“</span>
      </button>`;
    if (i <= 5) col1 += buttonHtml;
    else col2 += buttonHtml;
  }

  col1 += "</div>";
  col2 += `
    <div>
      <button class="stage-label-btn" onclick="startAllStages()">
        <span>ã™ã¹ã¦ã®ã ã‚“</span>
      </button>
    </div>
  </div>`;

  document.getElementById("mainArea").innerHTML = `
    <div style="display: flex; gap: 20px; width: 100%; max-width: 720px; margin: auto;">
      <!-- å·¦ï¼šç”»åƒ -->
<div style="flex: none; width: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
  <img src="neko3.png" style="width: 180px; height: auto;" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼">
  <div style="font-size: 11px; color: #666666; margin-top: 5px;">
      ã¾ãªã‚ã£ã¨ã‚¹ã‚¿ã‚¸ã‚ªã€€ãŒãã—ã‚…ã†ã‚¢ãƒ—ãƒª
  </div>
</div>

      <!-- å³ï¼šã‚¹ãƒ†ãƒ¼ã‚¸é¸æŠ -->
      <div style="flex: 1; display: flex; align-items: center;">
        <div style="display: flex; flex-direction: column; gap: 15px; width: 100%;">
          <div style="display: flex; gap: 15px;">
            ${col1}
            ${col2}
          </div>
        </div>
      </div>
    </div>
  `;

  // ãƒ•ãƒƒã‚¿ãƒ¼
  document.getElementById("footerArea").innerHTML = `
    <div style="font-size: 14px;">
      ã¡ã‚‡ã†ã›ã‚“ã™ã‚‹ã€€ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã€€ãˆã‚‰ã‚“ã§ã­ã€€ã€€ã€€ã€€ã©ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«ã€€ã¡ã‚‡ã†ã›ã‚“ã™ã‚‹ï¼Ÿ
    </div>
  `;
}

window.onload = function() {
  showInitialScreen();
};

function showBackToMenuModal() {
  const overlay = document.getElementById("backModalOverlay");
  overlay.style.display = "flex";

  document.getElementById("backOkButton").onclick = () => {
    isReturningToMenu = true;
    overlay.style.display = "none";
    showInitialScreen(); // â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹å‡¦ç†
  };

  document.getElementById("backCancelButton").onclick = () => {
    overlay.style.display = "none";
  };
}

function selectStageMode(stageNumber) {
  // ãƒ¡ã‚¤ãƒ³ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
  document.getElementById("mainArea").innerHTML = "";
  document.getElementById("footerArea").innerHTML = "";

  // ãƒ•ãƒƒã‚¿ãƒ¼ã«ã‚‚ã©ã‚‹ãƒœã‚¿ãƒ³
  document.getElementById("footerArea").innerHTML = `
    <div class="footer-content" style="display: flex; justify-content: space-between; align-items: center;">
      <div class="footer-left" style="font-weight: bold; font-size: 17px; margin-left: 30px">
        ${stageNumber}ã®ã ã‚“ã€€ã‚‚ã‚“ã ã„ãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã‚“ã§ã­
      </div>
      <div class="footer-right">
        <button class="action-btn" onclick="showBackToMenuModal()">ã‚‚ã©ã‚‹</button>
      </div>
    </div>
  `;

  // å„ãƒ¢ãƒ¼ãƒ‰æƒ…å ±ï¼ˆè¡¨ç¤ºã ã‘ï¼‰
  const modes = [
    {
      key: "ã®ã¼ã‚Š",
      label: "ã˜ã‚…ã‚“ã°ã‚“",
      desc: "ã¡ã„ã•ã„ã‹ãšã‹ã‚‰<br>ãŠãŠãã„ã‹ãš"
    },
    {
      key: "ãã ã‚Š",
      label: "ã¯ã‚“ãŸã„",
      desc: "ãŠãŠãã„ã‹ãšã‹ã‚‰<br>ã¡ã„ã•ã„ã‹ãš"
    },
    {
      key: "ãƒ©ãƒ³ãƒ€ãƒ ",
      label: "ãƒ©ãƒ³ãƒ€ãƒ ",
      desc: "ã°ã‚‰ã°ã‚‰ã«<br>ã‚‚ã‚“ã ã„ãŒã§ã‚‹ã‚ˆ"
    }
  ];

  const buttonsHtml = `
    <div class="mode-select-group">
      ${modes.map(m => `
        <button class="mode-select-btn" onclick="startStage(${stageNumber}, '${m.key}')">
          <div style="font-weight: bold;">${m.label}</div>
          <div style="font-size: 15px; margin-top: 6px; color: #666;">${m.desc}</div>
        </button>
      `).join("")}
    </div>
  `;

  // ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ã«æŒ¿å…¥
  document.getElementById("mainArea").innerHTML = `
    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px;">
      ${buttonsHtml}
      <div style="width: 500px; margin-top: 0px; background: #fff0f5; padding: 16px; border-radius: 8px; box-shadow: 1px 1px 6px rgba(0,0,0,0.1); text-align: center;">
        <div style="
          position: relative; 
          display: inline-block;
          background-color: white;
          color: #c84d7c;
          font-weight: bold;
          width: 400px;
          font-size: 16px;
          padding: 6px 12px;
          border-radius: 20px;
          margin-bottom: 10px;
          box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        ">
          <img src="facequestion.png" style="
            position: absolute;
            top: -20px;
            left: -20px;
            width: 80px;
            height: auto;
            z-index: 2;
          ">
          ãã‚Œãã‚Œã®ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã«ã¯â€¦
        </div><br>

        <span style="font-weight: bold;">ãœã‚“ã¶ã®ã‚‚ã‚“ã ã„ã«ã€€ã›ã„ã‹ã„ã™ã‚‹<br>
        ã²ã¨ã¤ã®ã‚‚ã‚“ã ã„ã‚’ã€€${cleartime}ã³ã‚‡ã†ã„ãªã„ã«ã€€ã›ã„ã‹ã„ã™ã‚‹<br>
        ãœã‚“ã¶ã‚¯ãƒªã‚¢ã§ãã‚‹ã‚ˆã†ã«ã€€ãŒã‚“ã°ã‚ã†ï¼
      </div>
    </div>
  `;
}

function startStage(stageNumber, mode) {
  currentStageNumber = stageNumber;
  currentStageMode = mode;
  questionSet = []; // åˆæœŸåŒ–

  // ãƒ•ãƒƒã‚¿ãƒ¼æ›´æ–°
  const modeLabel = {
    "ã®ã¼ã‚Š": "ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰",
    "ãã ã‚Š": "ã¯ã‚“ãŸã„ãƒ¢ãƒ¼ãƒ‰",
    "ãƒ©ãƒ³ãƒ€ãƒ ": "ãƒ©ãƒ³ãƒ€ãƒ ãƒ¢ãƒ¼ãƒ‰"
  }[mode] || "ãƒ¢ãƒ¼ãƒ‰";

  document.getElementById("footerArea").innerHTML = `
    <div class="footer-content" style="display: flex; justify-content: space-between; align-items: center;">
      <div class="footer-left" style="font-weight: bold; font-size: 17px; margin-left: 30px">
        ${stageNumber}ã®ã ã‚“ã€€${modeLabel}ã«ã¡ã‚‡ã†ã›ã‚“ï¼
      </div>
      <div class="footer-right">
        <button class="action-btn" onclick="showBackToMenuModal()">ã‚‚ã©ã‚‹</button>
      </div>
    </div>
  `;

  // å•é¡Œä½œæˆ
  let factors = [];
  if (mode === "ã®ã¼ã‚Š") {
    factors = [1, 2, 3, 4, 5, 6, 7, 8, 9];
  } else if (mode === "ãã ã‚Š") {
    factors = [9, 8, 7, 6, 5, 4, 3, 2, 1];
  } else if (mode === "ãƒ©ãƒ³ãƒ€ãƒ ") {
    factors = shuffleArray([1, 2, 3, 4, 5, 6, 7, 8, 9]);
  }

  questionSet = factors.map(f => ({
    left: stageNumber,
    right: f,
    answer: stageNumber * f
  }));

  // ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢è¡¨ç¤ºï¼ˆæº–å‚™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‹ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼‰
  document.getElementById("mainArea").innerHTML = `
    <div style="text-align: center; padding: 40px;">
      <div style="font-size: 24px; margin-bottom: 20px;">ã‚‚ã‚“ã ã„ãŒã¯ã˜ã¾ã‚‹ã‚ˆï¼ã˜ã‚…ã‚“ã³ã¯ã„ã„ï¼Ÿ</div>
      <button class="action-btn2" onclick="beginGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </div>
  `;
}

function shuffleArray(array) {
  const arr = [...array];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function beginGame() {
  currentQuestionIndex = 0;
  correctArray = [];
  timeArray = [];
  userAnswer = "";
  showQuestion(); // æœ€åˆã®å•é¡Œã‚’è¡¨ç¤º
}

function showQuestion() {
  const q = questionSet[currentQuestionIndex];

  userAnswer = "";
  startTime = Date.now();
  const stage = currentStageNumber; // 1ï½9 ã®æ®µ
const index = currentQuestionIndex;

let problemReading = "";
let answerReading = "";

// ã€Œã®ã¼ã‚Šã€ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã ã‘èª­ã¿æ–¹ã‚’å–å¾—
if (currentStageMode === "ã®ã¼ã‚Š" && questionReadings[stage] && answerReadings[stage]) {
  problemReading = questionReadings[stage][index] || "";
  answerReading = answerReadings[stage][index] || "";
}

const problemHTML = `
  <div style="position: relative; font-size: 45px; display: flex; justify-content: center; align-items: flex-start; gap: 12px; margin-bottom: 10px;">

    <!-- left -->
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div style="background-color: #ffddee; border-radius: 10px; width: 90px; height: 70px;
                  text-align: center; font-weight: bold; display: flex; justify-content: center; align-items: center;">
        ${q.left}
      </div>
      <div style="font-size: 16px; color: #666;">&nbsp;</div>
    </div>

    <!-- Ã— -->
    <div style="font-size: 35px; font-weight: bold; margin-top: 20px;">Ã—</div>

    <!-- right -->
    <div style="position: relative;">
      <div style="background-color: #b8f8b8; border-radius: 10px; width: 90px; height: 70px;
                  text-align: center; font-weight: bold; display: flex; justify-content: center; align-items: center;">
        ${q.right}
      </div>
      <!-- èª­ã¿ã‚’ right ãƒœãƒƒã‚¯ã‚¹ã®çœŸä¸‹ã«çµ¶å¯¾é…ç½®ï¼ˆâ†è¦ª box ã®ã‚µã‚¤ã‚ºã«å½±éŸ¿ã—ãªã„ï¼‰ -->
      <div style="
        position: absolute;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 16px;
        color: #666;
        font-weight: bold;
        width: 20em;
        letter-spacing: 1.5em;
        text-align: center;
        white-space: nowrap;
      ">
        ${problemReading}
      </div>
    </div>

    <!-- ï¼ -->
    <div style="font-size: 35px; font-weight: bold; margin-top: 20px;">ï¼</div>

<!-- answer -->
<div style="position: relative;">
  <div style="background-color: #eeeeee; border-radius: 10px; width: 90px; height: 70px;
              font-size: 45px; font-weight: bold; display: flex; justify-content: center; align-items: center;">
    <span id="answerDisplay">ï¼¿</span>
  </div>
  <!-- ç­”ãˆã®èª­ã¿ã‚’ absolute ã§æµ®ã‹ã›ã¦è¡¨ç¤º -->
  <div id="answerReading" style="
    position: absolute;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 16px;
    color: #e53935;
    font-weight: bold;
    width: 10em;
    letter-spacing: 0.2em;
    text-align: center;
    white-space: nowrap;
  ">
  </div>
</div>


    <!-- showAnswer -->
    <div id="showAnswer" style="
      position: absolute;
      right: -100px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 15px;
      color: #e53935;
      font-weight: bold;
      width: 100px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;">
    </div>
  </div>
`;


  // ãƒ†ãƒ³ã‚­ãƒ¼
const keypadHTML = `
  <div style="
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr 0.3fr 1fr;
    gap: 13px;
    justify-content: center;
    margin: auto;
    padding: 10px;
  ">
    ${
      [
        1, 2, 3, 4, 5, "", "â†",
        6, 7, 8, 9, 0, "", "OK"
      ].map(n => {
        const className =
          n === "OK" ? "key-btn ok-key" :
          n === "â†" ? "key-btn del-key" :
          n === "" ? "empty-key" :
          "key-btn";
        const label = n === "" ? "" : n;
        const onclick = n === "" ? "" : `onclick="handleKeyInput('${n}')"`;        
        return `<button class="${className}" ${onclick} style="font-size: 30px; font-weight: bold;">${label}</button>`;
      }).join("")
    }
  </div>
`;

  // ä¸‹æ®µ3åˆ—ï¼šã‚¿ã‚¤ãƒãƒ¼ / ãƒ†ãƒ³ã‚­ãƒ¼ / åˆ¤å®š
  const bottomRowHTML = `
    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 30px;">
<div id="timerArea" style="width: 150px; display: flex; flex-direction: column; align-items: center;">
  <svg width="80" height="80">
    <circle r="35" cx="40" cy="40" fill="none" stroke="#eee" stroke-width="8"/>
    <circle id="progressCircle" r="35" cx="40" cy="40" fill="none" stroke="#66ccff" stroke-width="8"
      stroke-dasharray="219.91" stroke-dashoffset="219.91" transform="rotate(-90 40 40)"/>
  </svg>

  <!-- æˆç¸¾ãƒœãƒƒã‚¯ã‚¹ -->
  <div style="margin-top: 10px; width: 90%;">
    <div style="border: 2px solid #66ccff; border-radius: 6px; overflow: hidden; margin-top: 10px; margin-bottom: 6px;">
      <div style="background: #66ccff; color: white; font-size: 16px; text-align: center; padding: 4px;">ã‚‚ã‚“ã ã„ã‚¯ãƒªã‚¢</div>
      <div id="answerClearCount" style="background: white; font-size: 22px; text-align: center; padding: 6px;"></div>
    </div>
    <div style="border: 2px solid #66ccff; border-radius: 6px; overflow: hidden;">
      <div style="background: #66ccff; color: white; font-size: 16px; text-align: center; padding: 4px;">ã˜ã‹ã‚“ã‚¯ãƒªã‚¢</div>
      <div id="timeClearCount" style="background: white; font-size: 22px; text-align: center; padding: 6px;"></div>
    </div>
  </div>
</div>


      <div>${keypadHTML}</div>
<div id="judgeArea" style="
  position: absolute;
  bottom: 20px;
  right: 30px;
  width: 150px;
  height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
">
  <div id="judgeResult" style="text-align: center; margin-bottom: 5px;"></div>
  <img id="judgeCharacter" src="${nomalimage}" style="
    width: 120px;
    height: auto;
    pointer-events: none;
  ">
</div>

  `;

  // å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
  document.getElementById("mainArea").innerHTML = `
    <div style="display: flex; flex-direction: column; align-items: center;">
      ${problemHTML}
      ${bottomRowHTML}
    </div>
  `;
  document.getElementById("judgeResult").innerHTML = "";
document.getElementById("judgeCharacter").src = nomalimage;
  document.getElementById("answerClearCount").innerText = answerokcount;
  document.getElementById("timeClearCount").innerText = timeokcount;
  document.getElementById("showAnswer").innerText = "";

startCircularTimer(cleartimesec); // â† ã“ã“è¿½åŠ ï¼

}

function handleKeyInput(key) {
  if (isInputLocked) return;
  if (key === "â†") {
    userAnswer = userAnswer.slice(0, -1);
  } else if (key === "OK") {
    checkAnswer();
    return;
  } else {
    if (userAnswer.length < 2) userAnswer += key;
  }
  document.getElementById("answerDisplay").innerText = userAnswer || "ï¼¿";
}

function checkAnswer() {
  isInputLocked = true;
  const q = questionSet[currentQuestionIndex];
  const correct = parseInt(userAnswer) === q.answer;
  const elapsedTime = (Date.now() - startTime) / 1000;
  const timeClear = elapsedTime <= cleartime && correct;
  const isCorrect = userAnswer === String(q.left * q.right);
  const stage = currentStageNumber;
const index = currentQuestionIndex;
const answerReading = (currentStageMode === "ã®ã¼ã‚Š" && answerReadings[stage]?.[index]) ? answerReadings[stage][index] : "";


// â—‹ or Ã— ã‚·ãƒ³ãƒœãƒ«
const symbol = isCorrect ? "â­•" : "âŒ";
const message = isCorrect ? "ã›ã„ã‹ã„ï¼" : "ã–ã‚“ã­ã‚“â€¦";

  if (timerAnimationId !== null) {
    cancelAnimationFrame(timerAnimationId);
    timerAnimationId = null;
  }
  correctArray.push(correct);
  timeArray.push(timeClear);

document.getElementById("judgeResult").innerHTML = `
  <div style="font-size: 75px;">${symbol}</div>
  <div style="font-size: 22px; font-weight: bold;">${message}</div>
`;
document.getElementById("showAnswer").innerHTML = `
  ã“ãŸãˆ<br><div style="font-size: 35px;">${q.answer}</div>
`;

document.getElementById("answerReading").innerText = answerReading;

document.getElementById("judgeCharacter").src = isCorrect ? smileimage : sadimage;
// åˆ¤å®šå‡¦ç†ã®ã‚ã¨ã«åŠ ãˆã‚‹
if (correct) {
  answerokcount++;
  document.getElementById("answerClearCount").innerText = answerokcount;
}

if (timeClear) {
  timeokcount++;
  document.getElementById("timeClearCount").innerText = timeokcount;
}

  // æ¬¡ã®å•é¡Œã«é€²ã‚€
  setTimeout(() => {
    isInputLocked = false;
    if (isReturningToMenu) return;
    currentQuestionIndex++;
    if (currentQuestionIndex < questionSet.length) {
      showQuestion();
    } else {
      // currentStageMode ã«ã‚ˆã£ã¦åˆ†å²
      if (currentStageMode === "ãƒ©ãƒ³ãƒ€ãƒ å…¨") {
        // ã™ã¹ã¦ã®ã ã‚“ç”¨
        showAllStagesResult();
      } else {
        // å„æ®µãƒ¢ãƒ¼ãƒ‰ç”¨
        showResult();
      }
    }
  }, 1500);

}

function startCircularTimer(duration = cleartimesec) {
  const circle = document.getElementById("progressCircle");
  const radius = 35;
  const circumference = 2 * Math.PI * radius;

  const start = Date.now();

  function animate() {
    const now = Date.now();
    const elapsed = now - start;
    const progress = Math.min(elapsed / duration, 1);
    const offset = circumference * (1 - progress);
    circle.setAttribute("stroke-dashoffset", offset);

    if (progress < 1) {
      timerAnimationId = requestAnimationFrame(animate);
    }
  }

  // åˆæœŸè¨­å®šï¼ˆãƒ€ãƒƒã‚·ãƒ¥ç·šã‚’å††å‘¨ã«ï¼‰
  circle.setAttribute("stroke-dasharray", circumference);
  circle.setAttribute("stroke-dashoffset", circumference); // ï¼ç©ºã®çŠ¶æ…‹
  timerAnimationId = requestAnimationFrame(animate);
}

function showResult() {
  let modeLabel = "";
if (currentStageMode === "ã®ã¼ã‚Š") {
  modeLabel = "ã˜ã‚…ã‚“ã°ã‚“";
} else if (currentStageMode === "ãã ã‚Š") {
  modeLabel = "ã¯ã‚“ãŸã„";
} else if (currentStageMode === "ãƒ©ãƒ³ãƒ€ãƒ ") {
  modeLabel = "ãƒ©ãƒ³ãƒ€ãƒ ";
}

  document.getElementById("mainArea").innerHTML = "";
  document.getElementById("footerArea").innerHTML = `
    <div class="footer-content" style="display: flex; justify-content: space-between; align-items: center;">
      <div class="footer-left" style="font-weight: bold; font-size: 20px; margin-left: 30px">
        ${currentStageNumber}ã®ã ã‚“ã€€${modeLabel}ãƒ¢ãƒ¼ãƒ‰ã€€ã›ã„ã›ãã¯ã£ã´ã‚‡ã†
      </div>
      <div class="footer-right">
      <button class="action-btn" onclick="showBackToMenuModal()">ã‚‚ã©ã‚‹</button>
      </div>
    </div>
  `;

  const main = document.getElementById("mainArea");
  main.style.display = "flex";
  main.style.flexDirection = "column";
  main.style.alignItems = "center";
  main.style.gap = "20px";

  const resultsRow = document.createElement("div");
  resultsRow.style.display = "flex";
  resultsRow.style.gap = "15px";

  // å•é¡Œã‚¯ãƒªã‚¢æ•°ãƒœãƒƒã‚¯ã‚¹
  const answerBox = document.createElement("div");
  answerBox.style.border = "2px solid #66ccff";
  answerBox.style.borderRadius = "10px";
  answerBox.style.padding = "10px";
  answerBox.style.textAlign = "center";
  answerBox.innerHTML = `<div style="font-size: 16px; margin-bottom: 5px;">ã‚‚ã‚“ã ã„ã‚¯ãƒªã‚¢ã™ã†</div><div id="answerResult" style="font-size: 100px; font-weight: bold; color: #2196F3;">0</div>`;
  answerBox.style.width = "150px";
  answerBox.style.height = "150px";
answerBox.style.display = "flex";
answerBox.style.flexDirection = "column";
answerBox.style.alignItems = "center";
answerBox.style.justifyContent = "center";
answerBox.style.position = "relative";
const answerStamp = document.createElement("span");
answerStamp.innerText = "ğŸ’®";
answerStamp.style.position = "absolute";
answerStamp.style.bottom = "-20px";
answerStamp.style.right = "-20px";
answerStamp.style.fontSize = "80px";
answerStamp.style.display = "none"; // æœ€åˆã¯éè¡¨ç¤º
answerBox.appendChild(answerStamp);


  resultsRow.appendChild(answerBox);

  // æ™‚é–“ã‚¯ãƒªã‚¢æ•°ãƒœãƒƒã‚¯ã‚¹
  const timeBox = document.createElement("div");
  timeBox.style.border = "2px solid #66ccff";
  timeBox.style.borderRadius = "10px";
  timeBox.style.padding = "10px";
  timeBox.style.textAlign = "center";
  timeBox.style.width = "150px";
  timeBox.style.height = "150px";
  timeBox.style.display = "flex";
timeBox.style.flexDirection = "column";
timeBox.style.alignItems = "center";
timeBox.style.justifyContent = "center";
timeBox.style.position = "relative";
  timeBox.innerHTML = `<div style="font-size: 16px; margin-bottom: 5px;">ã˜ã‹ã‚“ã‚¯ãƒªã‚¢ã™ã†</div><div id="timeResult" style="font-size: 100px; font-weight: bold; color: #4CAF50;">0</div>`;
const timeStamp = document.createElement("span");
timeStamp.innerText = "ğŸ’®";
timeStamp.style.position = "absolute";
timeStamp.style.bottom = "-20px";
timeStamp.style.right = "-20px";
timeStamp.style.fontSize = "80px";
timeStamp.style.display = "none";
timeBox.appendChild(timeStamp);

  resultsRow.appendChild(timeBox);

  main.appendChild(resultsRow);

  let answerCurrent = 0;
  const answerTarget = answerokcount;
  const answerTimer = setInterval(() => {
    if (answerCurrent < answerTarget) {
      answerCurrent++;
      document.getElementById("answerResult").innerText = answerCurrent;
    } else {
      clearInterval(answerTimer);
      if (answerTarget === 9) {
        answerStamp.style.display = "inline";
      }

      let timeCurrent = 0;
      const timeTarget = timeokcount;
      const timeTimer = setInterval(() => {
        if (timeCurrent < timeTarget) {
          timeCurrent++;
          document.getElementById("timeResult").innerText = timeCurrent;
        } else {
          clearInterval(timeTimer);
          if (timeTarget === 9) {
            timeStamp.style.display = "inline";
          }

          // æœ€çµ‚çµæœè¡¨ç¤ºãƒœãƒƒã‚¯ã‚¹
          const finalBox = document.createElement("div");
          finalBox.style.padding = "10px";
          finalBox.style.borderRadius = "12px";
          finalBox.style.textAlign = "center";
          finalBox.style.fontSize = "18px";
          finalBox.style.fontWeight = "bold";
          finalBox.style.boxShadow = "0 4px 10px rgba(0,0,0,0.1)";
          finalBox.style.animation = "pop 0.5s ease";
          finalBox.style.width = "150px";
          finalBox.style.height = "150px";
          finalBox.style.display = "flex";
finalBox.style.flexDirection = "column";
finalBox.style.alignItems = "center";
finalBox.style.justifyContent = "center";
finalBox.style.position = "relative";
const finalStamp = document.createElement("span");
finalStamp.innerText = "ğŸ’¯";
finalStamp.style.position = "absolute";
finalStamp.style.bottom = "-40px";
finalStamp.style.right = "-40px";
finalStamp.style.fontSize = "80px";
finalStamp.style.display = "none";

          resultsRow.appendChild(finalBox);
          const resultmessage = document.createElement("div");
          resultmessage.id = "resultMessage";
          resultmessage.style.marginTop = "10px";
          resultmessage.style.fontSize = "20px";
          resultmessage.style.color = "black";
          
          let message = "";
          let img = "";
          if (answerokcount === 9 && timeokcount === 9) {
            message = "ã‚¯ãƒªã‚¢ï¼";
            img = smileimage;
            finalBox.style.backgroundColor = "#ffeef3";
            resultmessage.innerText = `${currentStageNumber}ã®ã ã‚“ã€€${modeLabel}ãƒ¢ãƒ¼ãƒ‰ã€€ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼`;

            showModal(`${currentStageNumber}ã®ã ã‚“<br>ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼ğŸ‰`, true);
            launchConfetti(40);
          } else if (answerokcount === 9) {
            message = "ãŠã—ã„ï¼";
            img = nomalimage2;
            finalBox.style.backgroundColor = "#f5f0ff";
            resultmessage.innerText = "ãœã‚“ã‚‚ã‚“ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼ã¤ãã¯ã€€ã¯ã‚„ãã“ãŸãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚ã†ï¼";
          } else {
            message = "ã–ã‚“ã­ã‚“â€¦";
            img = sadimage;
            finalBox.style.backgroundColor = "#e6f7ff";
            resultmessage.innerText = "ã¾ãšã¯ã€€ã¾ã¡ãŒãˆãªã„ã§ã€€ãœã‚“ã‚‚ã‚“ã‚¯ãƒªã‚¢ã‚’ã‚ã–ãã†ï¼";
          }

          finalBox.innerHTML = `
            <div style="margin-bottom: 10px;">${message}</div>
            <img src="${img}" style="width: 100px; height: auto;">
          `;
          finalBox.appendChild(finalStamp);
          if (answerokcount === 9 && timeokcount === 9) {
            finalStamp.style.display = "inline";
          }
          main.appendChild(resultmessage);



          }
        }, 80);
      }
    }, 80);
  }

function launchConfetti(count = 30) {
  for (let i = 0; i < count; i++) {
    const confetti = document.createElement("div");
    confetti.className = "confetti";
    document.body.appendChild(confetti);

    // ç”»é¢ä¸­å¤®ã«å›ºå®šé…ç½®
    confetti.style.left = "50%";
    confetti.style.top = "50%";

    // ãƒ©ãƒ³ãƒ€ãƒ ãªè‰²ãƒ»ã‚µã‚¤ã‚º
    confetti.style.backgroundColor = randomColor();
    confetti.style.width = Math.random() * 8 + 4 + "px";
    confetti.style.height = confetti.style.width;
    const angle = Math.random() * 2 * Math.PI;
    const radius = 300 + Math.random() * 100;
    const x = Math.cos(angle) * radius;
    const y = Math.sin(angle) * radius;


    confetti.style.animation = `explode 1s ease-out forwards`;
    confetti.style.setProperty('--x', `${x}px`);
    confetti.style.setProperty('--y', `${y}px`);

    setTimeout(() => confetti.remove(), 1000);
  }
}

function randomColor() {
  const colors = ["#FF69B4", "#FFD700", "#87CEFA", "#98FB98", "#FFA07A"];
  return colors[Math.floor(Math.random() * colors.length)];
}

function showModal(message, showOkButton = true, onOk = null) {
  document.getElementById("modalMessage").innerHTML = message;
  document.getElementById("modalOverlay").style.display = "flex";

  const okButton = document.getElementById("modalOkButton");
  okButton.style.display = showOkButton ? "inline-block" : "none";

  // OKãƒœã‚¿ãƒ³ã«ä»¥å‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒæ®‹ã‚‰ãªã„ã‚ˆã†ã«ã¾ãšãƒªã‚»ãƒƒãƒˆ
  okButton.onclick = null;

  if (showOkButton && onOk) {
    okButton.onclick = () => {
      closeModal();
      onOk(); // â† OKãŒæŠ¼ã•ã‚ŒãŸã‚‰å®Ÿè¡Œ
    };
  } else if (showOkButton) {
    okButton.onclick = () => {
      closeModal();
    };
  }
}

function closeModal() {
  document.getElementById("modalOverlay").style.display = "none";
}

function startAllStages() {
  // â‘  ãƒ¡ã‚¤ãƒ³ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã‚¨ãƒªã‚¢ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
  document.getElementById("mainArea").innerHTML = "";
  document.getElementById("footerArea").innerHTML = `
    <div class="footer-content" style="display: flex; justify-content: space-between; align-items: center;">
      <div class="footer-left" style="font-weight: bold; font-size: 20px; margin-left: 30px">
        ã™ã¹ã¦ã®ã ã‚“ã€€ã«ã€€ã¡ã‚‡ã†ã›ã‚“ï¼
      </div>
      <div class="footer-right">
        <button class="action-btn" onclick="showBackToMenuModal()">ã‚‚ã©ã‚‹</button>
      </div>
    </div>
  `;

  // â‘¡ å•é¡Œä½œæˆï¼šã‹ã‘ã‚‰ã‚Œã‚‹æ•°ã€ã‹ã‘ã‚‹æ•°ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«10å€‹ãšã¤ç”Ÿæˆ
  allQuestions = Array.from({ length: 10 }, () => {
    const left = Math.floor(Math.random() * 9) + 1;
    const right = Math.floor(Math.random() * 9) + 1;
    return { left, right, answer: left * right };
  });

  // â‘£ ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼šãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
document.getElementById("mainArea").innerHTML = `
  <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px;">
    <div class="mode-select-group">
      <button class="mode-select-btn" onclick="startAllStageGame()" style="width: 350px; height: 100px;">
        <div style="font-weight: bold;">ã™ã¹ã¦ã®ã ã‚“ã€€ãƒ©ãƒ³ãƒ€ãƒ </div>
        <div style="font-size: 15px; margin-top: 6px; color: #666;">ã„ã‚ã‚“ãªã ã‚“ã‹ã‚‰ã€€ï¼‘ï¼ã‚‚ã‚“ã€€ã§ã¦ãã‚‹ã‚ˆï¼</div>
      </button>
    </div>

    <div style="width: 500px; background: #fff0f5; padding: 16px; border-radius: 8px; box-shadow: 1px 1px 6px rgba(0,0,0,0.1); text-align: center;">
      <div style="
        position: relative; 
        display: inline-block;
        background-color: white;
        color: #c84d7c;
        font-weight: bold;
        width: 400px;
        font-size: 16px;
        padding: 6px 12px;
        border-radius: 20px;
        margin-bottom: 10px;
        box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
      ">
        <img src="${nomalimage2}" style="
          position: absolute;
          top: -30px;
          left: -25px;
          width: 80px;
          height: auto;
          z-index: 2;
        ">
        ã™ã¹ã¦ã®ã ã‚“ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã«ã¯â€¦
      </div><br>
      ã™ã¹ã¦ã®ã ã‚“ã®ã‚‚ã‚“ã ã„ãŒã€€ãƒ©ãƒ³ãƒ€ãƒ ã«ï¼‘ï¼ã‚‚ã‚“ã§ã¾ã™<br>
      <span style="font-weight: bold;">
        ãœã‚“ã¶ã®ã‚‚ã‚“ã ã„ã«ã€€ã›ã„ã‹ã„ã—ã‚ˆã†<br>
        ã²ã¨ã¤ã®ã‚‚ã‚“ã ã„ã‚’ã€€${cleartime}ã³ã‚‡ã†ã„ãªã„ã«ã€€ã›ã„ã‹ã„ã—ã‚ˆã†
      </span>
    </div>
  </div>
`;

}

function startAllStageGame() {
  // ã‚¹ãƒ†ãƒ¼ã‚¸ç•ªå·ã¨ãƒ¢ãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«ï¼ˆå›ºå®šï¼‰
  const stageNumber = "ã™ã¹ã¦ã®ã ã‚“";
  const modeLabel = "ãƒ©ãƒ³ãƒ€ãƒ ãƒ¢ãƒ¼ãƒ‰";
  currentStageMode = "ãƒ©ãƒ³ãƒ€ãƒ å…¨"

  // ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼šæº–å‚™ç”»é¢ã‚’è¡¨ç¤º
  document.getElementById("mainArea").innerHTML = `
    <div style="text-align:center; padding:40px;">
      <div style="font-size:24px; margin-bottom:20px;">
        ã‚‚ã‚“ã ã„ãŒã¯ã˜ã¾ã‚‹ã‚ˆï¼ã˜ã‚…ã‚“ã³ã¯ã„ã„ï¼Ÿ
      </div>
      <button class="action-btn2" onclick="beginAllStagesGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </div>
  `;

  // ãƒ•ãƒƒã‚¿ãƒ¼ã‚¨ãƒªã‚¢ï¼šã‚¿ã‚¤ãƒˆãƒ«ã¨æˆ»ã‚‹ãƒœã‚¿ãƒ³
  document.getElementById("footerArea").innerHTML = `
    <div class="footer-content" style="display:flex;justify-content:space-between;align-items:center;">
      <div class="footer-left" style="font-weight:bold;font-size:20px;margin-left:30px">
        ${stageNumber}ã€€${modeLabel}ã«ã¡ã‚‡ã†ã›ã‚“ï¼
      </div>
      <div class="footer-right">
        <button class="action-btn" onclick="showBackToMenuModal()">ã‚‚ã©ã‚‹</button>
      </div>
    </div>
  `;
}

function beginAllStagesGame() {
  // å•é¡Œåˆ—ã‚’æµç”¨ã™ã‚‹ãŸã‚ questionSet ã«ã‚»ãƒƒãƒˆ
  questionSet = allQuestions;
  // ã‚ã¨ã¯é€šå¸¸ã® beginGame ã‚’å‘¼ã¶ã ã‘
  beginGame();
}

function showAllStagesResult() {
  const stageLabel = "ã™ã¹ã¦ã®ã ã‚“";
  const modeLabel = "ãƒ©ãƒ³ãƒ€ãƒ ";

  // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
  document.getElementById("mainArea").innerHTML = "";
  document.getElementById("footerArea").innerHTML = `
    <div class="footer-content" style="display:flex;justify-content:space-between;align-items:center;">
      <div class="footer-left" style="font-weight:bold;font-size:20px;margin-left:30px">
        ${stageLabel}ã€€${modeLabel}ãƒ¢ãƒ¼ãƒ‰ã€€ã›ã„ã›ãã¯ã£ã´ã‚‡ã†
      </div>
      <div class="footer-right"></div>
      <button class="action-btn" onclick="showBackToMenuModal()">ã‚‚ã©ã‚‹</button>
    </div>
  `;

  // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
  const main = document.getElementById("mainArea");
  main.style.display = "flex";
  main.style.flexDirection = "column";
  main.style.alignItems = "center";
  main.style.gap = "20px";

  // ãƒœãƒƒã‚¯ã‚¹è¡Œ
  const resultsRow = document.createElement("div");
  resultsRow.style.display = "flex";
  resultsRow.style.gap = "15px";

  // å•é¡Œã‚¯ãƒªã‚¢æ•°ãƒœãƒƒã‚¯ã‚¹
  const answerBox = document.createElement("div");
  Object.assign(answerBox.style, {
    border: "2px solid #66ccff",
    borderRadius: "10px",
    padding: "10px",
    textAlign: "center",
    width: "150px",
    height: "150px",
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    position: "relative"
  });
  answerBox.innerHTML = `
    <div style="font-size:16px;margin-bottom:5px;">ã‚‚ã‚“ã ã„ã‚¯ãƒªã‚¢ã™ã†</div>
    <div id="answerResult" style="font-size:100px;font-weight:bold;color:#2196F3;">0</div>
  `;
  const answerStamp = document.createElement("span");
  Object.assign(answerStamp.style, {
    position: "absolute",
    bottom: "-20px",
    right: "-20px",
    fontSize: "80px",
    display: "none"
  });
  answerStamp.innerText = "ğŸ’®";
  answerBox.appendChild(answerStamp);
  resultsRow.appendChild(answerBox);

  // æ™‚é–“ã‚¯ãƒªã‚¢æ•°ãƒœãƒƒã‚¯ã‚¹
  const timeBox = document.createElement("div");
  Object.assign(timeBox.style, {
    border: "2px solid #66ccff",
    borderRadius: "10px",
    padding: "10px",
    textAlign: "center",
    width: "150px",
    height: "150px",
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    position: "relative"
  });
  timeBox.innerHTML = `
    <div style="font-size:16px;margin-bottom:5px;">ã˜ã‹ã‚“ã‚¯ãƒªã‚¢ã™ã†</div>
    <div id="timeResult" style="font-size:100px;font-weight:bold;color:#4CAF50;">0</div>
  `;
  const timeStamp = document.createElement("span");
  Object.assign(timeStamp.style, {
    position: "absolute",
    bottom: "-20px",
    right: "-20px",
    fontSize: "80px",
    display: "none"
  });
  timeStamp.innerText = "ğŸ’®";
  timeBox.appendChild(timeStamp);
  resultsRow.appendChild(timeBox);

  main.appendChild(resultsRow);

  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ã‚¦ãƒ³ãƒˆ
  let ansCur = 0;
  const ansTar = answerokcount; // 0ï½10
  const ansTimer = setInterval(() => {
    if (ansCur < ansTar) {
      ansCur++;
      document.getElementById("answerResult").innerText = ansCur;
    } else {
      clearInterval(ansTimer);
      if (ansTar === 10) answerStamp.style.display = "inline";

      let timeCur = 0;
      const timeTar = timeokcount;
      const timeTimer = setInterval(() => {
        if (timeCur < timeTar) {
          timeCur++;
          document.getElementById("timeResult").innerText = timeCur;
        } else {
          clearInterval(timeTimer);
          if (timeTar === 10) timeStamp.style.display = "inline";

          // æœ€çµ‚çµæœè¡¨ç¤ºãƒœãƒƒã‚¯ã‚¹
          const finalBox = document.createElement("div");
          finalBox.style.padding = "10px";
          finalBox.style.borderRadius = "12px";
          finalBox.style.textAlign = "center";
          finalBox.style.fontSize = "18px";
          finalBox.style.fontWeight = "bold";
          finalBox.style.boxShadow = "0 4px 10px rgba(0,0,0,0.1)";
          finalBox.style.animation = "pop 0.5s ease";
          finalBox.style.width = "150px";
          finalBox.style.height = "150px";
          finalBox.style.display = "flex";
          finalBox.style.flexDirection = "column";
          finalBox.style.alignItems = "center";
          finalBox.style.justifyContent = "center";
          finalBox.style.position = "relative";
          const finalStamp = document.createElement("span");
          finalStamp.innerText = "ğŸ’¯";
          finalStamp.style.position = "absolute";
          finalStamp.style.bottom = "-40px";
          finalStamp.style.right = "-40px";
          finalStamp.style.fontSize = "80px";
          finalStamp.style.display = "none";

          resultsRow.appendChild(finalBox);
          const resultmessage = document.createElement("div");
          resultmessage.id = "resultMessage";
          resultmessage.style.marginTop = "10px";
          resultmessage.style.fontSize = "20px";
          resultmessage.style.color = "black";
          
          let message = "";
          let img = "";
          if (ansTar === 10 && timeTar === 10) {
            message = "ã‚¯ãƒªã‚¢ï¼";
            img = smileimage;
            finalBox.style.backgroundColor = "#ffeef3";
            resultmessage.innerText = `ã™ã¹ã¦ã®ã ã‚“ã€€${modeLabel}ãƒ¢ãƒ¼ãƒ‰ã€€ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼`;

            showModal(`ã™ã¹ã¦ã®ã ã‚“<br>ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼ğŸ‰`, true);
            launchConfetti(40);
          } else if (ansTar === 10) {
            message = "ãŠã—ã„ï¼";
            img = nomalimage2;
            finalBox.style.backgroundColor = "#f5f0ff";
            resultmessage.innerText = "ãœã‚“ã‚‚ã‚“ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼ã¤ãã¯ã€€ã¯ã‚„ãã“ãŸãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚ã†ï¼";
          } else {
            message = "ã–ã‚“ã­ã‚“â€¦";
            img = sadimage;
            finalBox.style.backgroundColor = "#e6f7ff";
            resultmessage.innerText = "ã¾ãšã¯ã€€ã¾ã¡ãŒãˆãªã„ã§ã€€ãœã‚“ã‚‚ã‚“ã‚¯ãƒªã‚¢ã‚’ã‚ã–ãã†ï¼";
          }

          finalBox.innerHTML = `
            <div style="margin-bottom: 10px;">${message}</div>
            <img src="${img}" style="width: 100px; height: auto;">
          `;
          finalBox.appendChild(finalStamp);
          if (ansTar === 10 && timeTar === 10) {
            finalStamp.style.display = "inline";
          }
          main.appendChild(resultmessage);


        }
      }, 80);
    }
  }, 80);
}

const style = document.createElement("style");
style.innerHTML = `
@keyframes explode {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(var(--x), var(--y)) scale(0.8);
    opacity: 0;
  }
}

@keyframes pop {
  0% {
    transform: scale(0.5);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}
`;
document.head.appendChild(style);

</script>
</body>
</html>